import{r as t,j as o,h as i,H as e}from"./p-900143dd.js";import"./p-36ddbbc3.js";import{D as s}from"./p-f14a9a94.js";import"./p-d7254bc1.js";import"./p-f8acc8c5.js";import"./p-316cddd3.js";import"./p-5e1589de.js";import"./p-bf9feb13.js";import{p as l}from"./p-0ef20132.js";import{u as r}from"./p-7fe253be.js";const a=class{constructor(i){t(this,i),this.codeAll="",this.toast=o(this,"toast",7)}componentWillLoad(){this.initCodeAll()}async initCodeAll(){if(this.dataScreenId){let t=await s.getDataScreen(this.dataScreenId);delete t.id,this.codeAll=JSON.stringify(t,null,1)}}handleCodeChange(t){this.codeAll=t.detail.value}checkDataOJBK(t){try{let o=JSON.parse(t);return!!(o.canvasOption.w&&o.canvasOption.h&&o.canvasOption.bgc&&-1!==Object.prototype.toString.call(o.componentsData).indexOf("Array"))||(this.toast.emit("缺少必要参数!"),!1)}catch(o){return console.error(o),this.toast.emit("数据格式错误!"),!1}}async saveComponentsData(){if(this.checkDataOJBK(this.codeAll)){let t=JSON.parse(this.codeAll);if(this.dataScreenId){let o=await s.getDataScreen(this.dataScreenId);t.id=o.id,await s.setDataScreenById(o.id,t)}else t.id=r.v4(),await s.addDataScreen(t);this.closePopover(t.id)}}cancelModify(){this.closePopover("")}closePopover(t){this.dismissCallBack&&this.dismissCallBack(t),l.dismiss()}render(){return i(e,{style:{flex:"1",display:"flex","flex-direction":"column"}},i("ion-toolbar",{color:"secondary"},i("ion-title",null,"show me the code")),i("div",{class:"popover_content"},i("ion-textarea",{placeholder:"复制大屏数据到这导入",debounce:300,wrap:"soft",onIonChange:t=>{this.handleCodeChange(t)},value:this.codeAll}),i("ion-row",null,i("ion-col",null,i("ion-button",{onClick:()=>{this.saveComponentsData()},color:"primary",expand:"block"},"保存")),i("ion-col",null,i("ion-button",{onClick:()=>{this.cancelModify()},color:"primary",fill:"outline",expand:"block"},"取消")))))}static get style(){return"ion-textarea{-ms-flex:1!important;flex:1!important;display:-ms-flexbox!important;display:flex!important;font-size:15px!important}.popover_content{-ms-flex:1;flex:1;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;overflow:hidden;-ms-flex-pack:justify;justify-content:space-between}"}};export{a as popover_code_modify};