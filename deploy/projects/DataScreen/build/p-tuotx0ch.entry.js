import{r as t,j as s,h as a,H as i,e as h}from"./p-900143dd.js";import"./p-36ddbbc3.js";import"./p-f14a9a94.js";import{i as e,k as r,a as o,s as n,g as c,c as p,h as l,d}from"./p-8be1997b.js";import"./p-d7254bc1.js";import"./p-f8acc8c5.js";import"./p-316cddd3.js";import"./p-5e1589de.js";import"./p-bf9feb13.js";import"./p-0ef20132.js";import{a as g}from"./p-53ddc05f.js";const m=class{constructor(a){t(this,a),this.canModify=!1,this.isChoose=!1,this.scale=1,this.isDomDrag=!1,this.isHover=!1,this.cyScale=s(this,"cyScale",7),this.cyDrag=s(this,"cyDrag",7),this.choose=s(this,"choose",7)}watchHandler(t){this.setZindexByChoose(t)}componentDidLoad(){this.setZindexByChoose(this.isChoose)}setZindexByChoose(t){this.el.style.zIndex=t?"999":""}onDragScaleDown(t,s,a,i){t.stopPropagation(),this.isDomDrag=!0;var h=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g),e=Math.floor(t.clientX-(h&&parseInt(h[0])*this.scale||0)-a*this.scale),r=Math.floor(t.clientY-(h&&parseInt(h[1])*this.scale||0)-i*this.scale),o=this.el.clientWidth,n=this.el.clientHeight,c=h[0],p=h[1];document.onpointermove=t=>{t.stopPropagation(),this.onDragScaleMove(t,s,e,r,o,n,parseInt(c),parseInt(p))},document.onpointerup=()=>{this.isDomDrag=!1,document.onpointermove=null,document.onpointerup=null;var t=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g);this.cyScale.emit({w:parseInt(this.el.clientWidth+""),h:parseInt(this.el.clientHeight+""),x:parseInt(t[0]),y:parseInt(t[1])})}}onDragScaleMove(t,s,a,i,h,e,r,o){switch(s){case"righttop":this.el.style.width=Math.floor((t.clientX-a)/this.scale)-r+"px";var n=Math.floor((e+o)*this.scale+i-t.clientY)/this.scale;this.el.style.height=n>0?n+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${r}px, ${(t.clientY-i)/this.scale}px`);break;case"lefttop":var c=Math.floor((h+r)*this.scale+a-t.clientX)/this.scale;this.el.style.width=c>0?c+"px":"0px",n=Math.floor((e+o)*this.scale+i-t.clientY)/this.scale,this.el.style.height=n>0?n+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-a)/this.scale}px, ${(t.clientY-i)/this.scale}px`);break;case"leftbottom":c=Math.floor((h+r)*this.scale+a-t.clientX)/this.scale,this.el.style.width=c>0?c+"px":"0px",this.el.style.height=Math.floor((t.clientY-i)/this.scale)-o+"px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-a)/this.scale}px, ${o}px`);break;case"rightbottom":this.el.style.width=Math.floor((t.clientX-a)/this.scale)-r+"px",this.el.style.height=Math.floor((t.clientY-i)/this.scale)-o+"px";break;case"top":n=Math.floor((e+o)*this.scale+i-t.clientY)/this.scale,this.el.style.height=n>0?n+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${r}px, ${(t.clientY-i)/this.scale}px`);break;case"left":c=Math.floor((h+r)*this.scale+a-t.clientX)/this.scale,this.el.style.width=c>0?c+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-a)/this.scale}px, ${o}px`);break;case"bottom":this.el.style.height=Math.floor((t.clientY-i)/this.scale)-o+"px";break;case"right":this.el.style.width=Math.floor((t.clientX-a)/this.scale)-r+"px"}}onDragBoxDown(t){t.preventDefault(),t.stopPropagation(),this.isDomDrag=!0;let s=t.clientX,a=t.clientY;var i=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g),h=s-(i&&parseInt(i[0])*this.scale||0),e=a-(i&&parseInt(i[1])*this.scale||0);document.onpointermove=t=>{t.stopPropagation(),this.onDragBoxMove(t,h,e)},document.onpointerup=()=>{this.isDomDrag=!1,document.onpointermove=null,document.onpointerup=null;var t=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g);this.cyDrag.emit({w:parseInt(this.el.clientWidth+""),h:parseInt(this.el.clientHeight+""),x:parseInt(t[0]),y:parseInt(t[1])})}}onDragBoxMove(t,s,a){this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-s)/this.scale}px, ${(t.clientY-a)/this.scale}px`)}handleDomChoose(t){t.preventDefault(),t.stopPropagation(),this.choose.emit()}render(){return a(i,{style:{"touch-action":this.isChoose?"none":"auto",border:this.isHover&&this.canModify&&!this.isChoose?"1px solid var(--border-color)":""},onMouseEnter:()=>{this.isHover=!0},onMouseLeave:()=>{this.isHover=!1},onClick:t=>{this.handleDomChoose(t)},onPointerDown:t=>{this.canModify&&this.isChoose&&this.onDragBoxDown(t)}},a("div",{class:this.canModify&&this.isChoose||this.isDomDrag?"draggable_over":"draggable_over hiddlen"},a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_righttop",onPointerDown:t=>{this.onDragScaleDown(t,"righttop",this.el.clientWidth,0)}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_rightbottom",onPointerDown:t=>{this.onDragScaleDown(t,"rightbottom",this.el.clientWidth,this.el.clientHeight)}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_leftbottom",onPointerDown:t=>{this.onDragScaleDown(t,"leftbottom",0,this.el.clientHeight)}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_lefttop",onPointerDown:t=>{this.onDragScaleDown(t,"lefttop",0,0)}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_right",onPointerDown:t=>{this.onDragScaleDown(t,"right",this.el.clientWidth,Math.floor(.5*this.el.clientHeight))}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_bottom",onPointerDown:t=>{this.onDragScaleDown(t,"bottom",Math.floor(.5*this.el.clientWidth),this.el.clientHeight)}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_left",onPointerDown:t=>{this.onDragScaleDown(t,"left",0,Math.floor(.5*this.el.clientHeight))}}),a("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_top",onPointerDown:t=>{this.onDragScaleDown(t,"top",Math.floor(.5*this.el.clientWidth),0)}})),a("div",{class:"container"},a("slot",null)))}get el(){return h(this)}static get watchers(){return{isChoose:["watchHandler"]}}static get style(){return":host{--color:#fff;--background:transparent;--choose-background:rgba(27,70,117,0.5);--padding:0px;--overflow:hidden;--opacity:1;--point-size:40px;--border-width:2px;padding:var(--padding);padding:0!important;margin:0!important;display:block;position:relative;will-change:transform;-webkit-transform-origin:50% 50%;transform-origin:50% 50%}*,:host{-webkit-box-sizing:border-box;box-sizing:border-box}.container{width:100%;height:100%;color:var(--color);overflow:var(--overflow);opacity:var(--opacity)}.draggable_over{position:absolute;top:0;bottom:0;left:0;right:0;cursor:-webkit-grab;cursor:grab;z-index:999;border-width:var(--border-width);border-style:solid;border-color:var(--border-color);background:var(--choose-background)}.hiddlen{visibility:hidden;-webkit-box-shadow:none;box-shadow:none}.drag_tag{position:absolute;width:var(--point-size);height:var(--point-size);z-index:999;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;-ms-touch-action:none;touch-action:none}.drag_tag:before{content:\"\";position:relative;background:var(--color,#fff);width:calc(.3 * var(--point-size));height:calc(.3 * var(--point-size));border-radius:50%}.drag_tag_right{top:calc(50% - calc(.5 * var(--point-size)));right:calc(-1 * calc(.5 * var(--point-size)));cursor:move}.drag_tag_bottom{right:calc(50% - calc(.5 * var(--point-size)))}.drag_tag_bottom,.drag_tag_rightbottom{bottom:calc(-1 * calc(.5 * var(--point-size)));cursor:move}.drag_tag_rightbottom{right:calc(-1 * calc(.5 * var(--point-size)))}.drag_tag_righttop{right:0;right:calc(-1 * calc(.5 * var(--point-size)));top:calc(-1 * calc(.5 * var(--point-size)));cursor:move}.drag_tag_leftbottom{left:calc(-1 * calc(.5 * var(--point-size)));bottom:calc(-1 * calc(.5 * var(--point-size)));cursor:move}.drag_tag_left{top:calc(50% - calc(.5* var(--point-size)));left:calc(-1 * calc(.5* var(--point-size)));cursor:move}.drag_tag_lefttop{left:calc(-1 * calc(.5 * var(--point-size)));top:calc(-1 * calc(.5 * var(--point-size)));cursor:move}.drag_tag_top{top:calc(-1 * calc(.5* var(--point-size)));left:calc(50% - calc(.5* var(--point-size)));cursor:move}"}},x=class{constructor(a){t(this,a),this.scale=100,this.canModify=!0,this.chooseComId="",this.comOptionList=[],this.popover=s(this,"popover",7),this.canvasChange=s(this,"canvasChange",7)}watchHandler(t){this.upDateElSize(this.canvasOption,t)}componentWillLoad(){e(this.el),this.canvasOption=r(),this.mapComDatasToState(o())}upDateElSize(t,s){this.el.style.width=Math.floor(s/100*parseInt(t.w))+"px",this.el.style.height=Math.floor(s/100*parseInt(t.h))+"px"}async setDataScreen(t,s,a=!0){n(t,s,a)}async getDataScreen(t){return await c(t)}async getCanvasSize(){return this.canvasOption?{w:parseInt(this.canvasOption.w),h:parseInt(this.canvasOption.h)}:null}async mapComDatasToState(t){this.comOptionList=t}async chooseComponentById(t){t!==this.chooseComId&&(this.chooseComId=t,await p(t))}async setCanvasConfig(t){this.canvasOption=Object.assign({},t),this.canvasChange.emit(),this.upDateElSize(this.canvasOption,this.scale)}handleDraggableDrag(t,s){s.data.view.x===t.detail.x&&s.data.view.y===t.detail.y||(s.data.view.x=t.detail.x+"",s.data.view.y=t.detail.y+"",l(s,!0,!0))}handleDraggableScale(t,s){s.data.view.w===t.detail.w&&s.data.view.h===t.detail.h||(s.data.view.w=t.detail.w+"",s.data.view.h=t.detail.h+"",s.data.view.x=t.detail.x+"",s.data.view.y=t.detail.y+"",l(s,!0,!0))}async popoverContextMenu(t,s){t.preventDefault(),t.stopPropagation(),await this.chooseComponentById(s),this.popover.emit({component:"popover-draggable-contextmenu",cssClass:"contextmenu-popover",event:t,showBackdrop:!1,componentProps:{comId:s}})}render(){return this.canvasOption?a("div",{class:"drag_container",style:{transform:`scale(${this.scale/100})`,width:this.canvasOption.w+"px",height:this.canvasOption.h+"px","background-color":this.canvasOption.bgc+"","background-image":this.canvasOption.bgi?`url(${this.canvasOption.bgi})`:"",overflow:this.canModify?"inherit":"hidden"}},this.comOptionList.map(t=>a("cy-draggable",{key:t.id,onContextMenu:s=>{this.canModify&&this.popoverContextMenu(s,t.id)},isChoose:this.chooseComId==t.id,canModify:this.canModify,scale:Math.round(this.scale)/100,onCyDrag:s=>{this.handleDraggableDrag(s,t)},onCyScale:s=>{this.handleDraggableScale(s,t)},onChoose:()=>{this.chooseComponentById(t.id)},style:{position:"absolute",transform:`translate(${t.data.view.x}px, ${t.data.view.y}px) rotate(${t.data.view.deg}deg)`,width:t.data.view.w+"px",height:t.data.view.h+"px","--opacity":t.data.view.opacity+""}},a("draggable-adapter",{key:t.id,comOptionData:t,canModify:this.canModify})))):null}get el(){return h(this)}static get watchers(){return{scale:["watchHandler"]}}static get style(){return"datascreen-canvas{--box-shadow:var(--ion-background-shade,#1c1c1c) 0 0 30px 0;--background:var(--datascreen-canvas-bg,#282830);display:inline-block;-webkit-transform-origin:0 0;transform-origin:0 0}datascreen-canvas .drag_container{position:absolute;width:100%;height:100%;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transition:all .5s ease-in;transition:all .5s ease-in;background-size:cover,contain;background-position:50%,100% 100%;background-repeat:no-repeat,no-repeat;-webkit-box-shadow:rgba(0,0,0,.5) 0 0 30px 0;box-shadow:0 0 30px 0 rgba(0,0,0,.5)}"}},u=class{constructor(a){t(this,a),this.minCanvasScale=15,this.maxCanvasSCale=300,this.padding=0,this.canvasScaleChange=s(this,"canvasScaleChange",7)}componentDidLoad(){this.resizeSCale()}customEventHandler(){this.resizeSCale()}async resizeSCale(){let t,s=this.el.querySelector("datascreen-canvas"),a=this.el.clientWidth-2*this.padding,i=this.el.clientHeight-2*this.padding,h=await s.getCanvasSize();s&&h&&h&&(t=(t=(t=h.w/h.h>a/i?a/h.w*100:i/h.h*100)>this.minCanvasScale?t:this.minCanvasScale)>this.maxCanvasSCale?this.maxCanvasSCale:t,t=Math.ceil(100*t)/100,this.canvasScaleChange.emit(t),s.scale=t)}render(){return a(i,{style:{padding:this.padding+"px"}},a("slot",null))}get el(){return h(this)}static get style(){return"datascreen-canvas-content{width:100%;height:100%;display:block;overflow:auto;position:relative;-webkit-box-sizing:border-box;box-sizing:border-box}"}},D=class{constructor(a){t(this,a),this.canModify=!1,this.alert=s(this,"alert",7),this.toast=s(this,"toast",7)}watchHandler(t,s){JSON.stringify(t.data.api_data)!==JSON.stringify(s.data.api_data)&&this.resignDataReceiver()}componentWillLoad(){this.resignDataReceiver()}resignDataReceiver(){this.comOptionData.data.api_data&&g(this.comOptionData.id,d({},this.comOptionData.data.api_data),t=>{this.apiData=t})}render(){switch(this.comOptionData.comName.split("-")[0]||""){case"media":return a("media-adapter",{canModify:this.canModify,comData:this.comOptionData,dataSource:this.apiData});case"chart":return a("chart-adapter",{comDataView:this.comOptionData.data.view,comDataConfig:this.comOptionData.data.config,comDataApiData:this.comOptionData.data.api_data,dataSource:this.apiData});case"text":return a("text-adapter",{comData:this.comOptionData,comDataConfig:this.comOptionData.data.config,dataSource:this.apiData});case"table":return a("table-adapter",{comDataView:this.comOptionData.data.view,comDataConfig:this.comOptionData.data.config,dataSource:this.apiData})}}static get watchers(){return{comOptionData:["watchHandler"]}}static get style(){return""}};export{m as cy_draggable,x as datascreen_canvas,u as datascreen_canvas_content,D as draggable_adapter};